# Render.com Deployment Setup - Complete âœ…

## What Changed

### New Files

1. **`render.yaml`** - Render deployment configuration
2. **`DEPLOYMENT.md`** - Complete deployment guide

### Modified Files

1. **`server/src/index.ts`**

   - âœ… Serves static client build in production (`NODE_ENV=production`)
   - âœ… Uses HTTP in production (Render provides HTTPS proxy)
   - âœ… Keeps HTTPS for local dev (unchanged)

2. **`package.json`** (root)

   - Added `build` script for production builds
   - Added `start:prod` script

3. **`.gitignore`**
   - Updated to allow `server/cache/` files in git (except tokens.json)
   - Keeps ignoring `**/dist` and `**/node_modules`

## Local Development - Unchanged âœ…

Your local dev setup works exactly as before:

```bash
# Start dev servers (HTTPS on localhost:5000, client on localhost:3000)
npm start

# Or individually
cd server && npm run dev
cd client && npm run dev
```

**Nothing changed for local development!**

## Production Deployment

### Quick Start

1. Push to GitHub:

   ```bash
   git add .
   git commit -m "Add Render deployment"
   git push origin main
   ```

2. Go to [Render Dashboard](https://dashboard.render.com/)
3. Create new **Web Service** from your GitHub repo
4. Render auto-detects `render.yaml`
5. Set environment variables (see DEPLOYMENT.md)
6. Deploy!

### Required Environment Variables

Set these in Render dashboard:

- `YAHOO_CLIENT_ID` - From Yahoo Developer Console
- `YAHOO_CLIENT_SECRET` - From Yahoo Developer Console
- `YAHOO_REDIRECT_URI` - `https://your-app.onrender.com/auth/yahoo/callback`
- `SESSION_SECRET` - Auto-generated by Render
- `BASE_URL` - `https://your-app.onrender.com`
- `FRONTEND_URL` - `https://your-app.onrender.com`

### Important: Update Yahoo App

Add your Render URL to Yahoo Developer Console:

- Go to your Yahoo app settings
- Add redirect URI: `https://your-app-name.onrender.com/auth/yahoo/callback`

## How It Works

### Development Mode

- `NODE_ENV` is not set or is `development`
- Server runs on HTTPS (localhost:5000) with local certs
- Client runs separately on Vite dev server (localhost:3000)
- API calls proxied from client to server

### Production Mode

- `NODE_ENV=production`
- Server runs on HTTP (Render provides HTTPS externally)
- Server serves built client files from `client/dist`
- Single service on one URL
- All routes serve React app, API routes handled by Express

## File Caching & Storage

**Good news:** Render's free tier has **persistent disk storage**!

- âœ… `server/cache/` directory persists between deploys
- âœ… Scoreboards, player info, Sleeper data stay cached
- âœ… Tokens in `tokens.json` persist (but not in git)
- âœ… Cache rebuilds only if files are missing

**Note:** Free tier spins down after 15 min inactivity

- First request takes 30-60s to wake up
- Cache files remain intact

## Testing Locally with Production Build

Want to test production mode locally?

```bash
# Build both client and server
npm run build

# Start in production mode
NODE_ENV=production npm run start:prod
```

Then visit `http://localhost:5000` (server serves the built React app).

## Troubleshooting

See `DEPLOYMENT.md` for:

- Step-by-step deployment guide
- Common errors and solutions
- Monitoring tips
- Free tier limitations

## Next Steps

1. Commit and push these changes
2. Follow `DEPLOYMENT.md` to deploy
3. Test your deployed app
4. Share the URL!

**Everything is ready to deploy! ðŸš€**
